{% extends "base.html" %}
{% load static %}

{% block head %}
    <link rel="stylesheet" href="{% static "css/styles.css" %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">

    <style>
        .container-fluid {
            padding: 0;
        }

        .qrcode-wrapper {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .wallet-address {
            font-size: 0.85rem;
            word-break: break-all;
        }

        .hidden {
            display: none !important;
        }
    </style>
{% endblock %}

{% block content %}


    <div class="container-fluid p-0">
        <div class="row justify-content-center align-items-center">
            <div class="col-12 text-center py-3">
                <small id="total_cost" class="h5">Total amount: <strong>{{ order.total_cost }}</strong>$</small>
            </div>
            <div class="col-12 text-center mb-3">
                <div class="alert alert-info" role="alert">
                    Click on the address to copy
                </div>
                <div class="alert alert-info" role="alert">
                    After you confirm transfer - we will wait acception of the transfer in blockchain and after
                    that will deliver package to your address, if you want to change order address - please contact
                    us in support chat
                </div>
            </div>
            <div class="col-12">
                <div class="accordion" id="walletAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingTRC20">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseTRC20" aria-expanded="true" aria-controls="collapseTRC20">
                                TRC20
                            </button>
                        </h2>
                        <div id="collapseTRC20" class="accordion-collapse collapse show" aria-labelledby="headingTRC20"
                             data-bs-parent="#walletAccordion">
                            <div class="accordion-body text-center">
                                <div id="qrcodeTRC20" class="qrcode-wrapper"></div>
                                <div class="wallet-address mb-3">
                                    <span id="wallet-address-TRC20" class="h5"
                                          onclick="copyAddress('TRC20')"><strong>XXXXXXXXXXXXXXX</strong></span>
                                </div>
                                <div id="copy-message-TRC20" class="mt-3 alert alert-success" style="display: none;">
                                    Address copied!
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingERC20">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseERC20" aria-expanded="false" aria-controls="collapseERC20">
                                ERC20
                            </button>
                        </h2>
                        <div id="collapseERC20" class="accordion-collapse collapse" aria-labelledby="headingERC20"
                             data-bs-parent="#walletAccordion">
                            <div class="accordion-body text-center">
                                <div id="qrcodeERC20" class="qrcode-wrapper"></div>
                                <div class="wallet-address mb-3">
                                    <span id="wallet-address-ERC20" class="h5"
                                          onclick="copyAddress('ERC20')"><strong>XXXXXXXXXXXXXXX</strong></span>
                                </div>
                                <div id="copy-message-ERC20" class="mt-3 alert alert-success" style="display: none;">
                                    Address copied!
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingBEP20">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseBEP20" aria-expanded="false" aria-controls="collapseBEP20">
                                BEP20
                            </button>
                        </h2>
                        <div id="collapseBEP20" class="accordion-collapse collapse" aria-labelledby="headingBEP20"
                             data-bs-parent="#walletAccordion">
                            <div class="accordion-body text-center">
                                <div id="qrcodeBEP20" class="qrcode-wrapper"></div>
                                <div class="wallet-address mb-3">
                                    <span id="wallet-address-BEP20" class="h5"
                                          onclick="copyAddress('BEP20')"><strong>XXXXXXXXXXXXXXX</strong></span>
                                </div>
                                <div id="copy-message-BEP20" class="mt-3 alert alert-success" style="display: none;">
                                    Address copied!
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 text-center mt-3">
                <a href="#" id="paid-link" data-url="{% url 'paid-order' order.uuid %}">
                    <button class="btn btn-outline-primary">Confirm payment</button>
                </a>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"
            integrity="sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js" crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>
    <script>
        function copyAddress(walletType) {
            const walletAddress = document.getElementById('wallet-address-' + walletType).innerText;
            navigator.clipboard.writeText(walletAddress).then(function () {
                const copyMessage = document.getElementById('copy-message-' + walletType);
                copyMessage.style.display = 'block';
                setTimeout(function () {
                    copyMessage.style.display = 'none';
                }, 2000);
            }, function (err) {
                console.error('Could not copy text: ', err);
            });
        }

        function generateQRCode(walletType, walletAddress) {
            new QRCode(document.getElementById('qrcode' + walletType), walletAddress);
        }

        document.addEventListener("DOMContentLoaded", function () {
            generateQRCode('TRC20', 'XXXXXXXXXXXXXXX');
            generateQRCode('ERC20', 'XXXXXXXXXXXXXXX');
            generateQRCode('BEP20', 'XXXXXXXXXXXXXXX');
        });
    </script>
    <script>
        document.getElementById("paid-link").addEventListener("click", function (event) {
            event.preventDefault();
            const url = this.getAttribute("data-url");
            if (confirm("Did you really transfer money to this address?")) {
                window.location.href = url;
            } else {
                return false
            }
        });
    </script>
    <script>
        toastr.options = {
            preventDuplicates: true,
            timeOut: 10000,
            progressBar: true,
        }

        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'success' %}
                    toastr.success('{{ message }}');
                {% elif message.tags == 'error' %}
                    toastr.error('{{ message }}');
                {% elif message.tags == 'warning' %}
                    toastr.warning('{{ message }}');
                {% elif message.tags == 'info' %}
                    toastr.info('{{ message }}');
                {% else %}
                    toastr.info('{{ message }}');
                {% endif %}
            {% endfor %}
        {% endif %}
    </script>
{% endblock %}

{% block script %}
{% endblock %}
